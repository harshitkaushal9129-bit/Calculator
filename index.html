<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MI PLAYER PRO - Kaushal Ji</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root { 
            --main: #00ffcc; --bg: #0a0a0a; --panel: #151515;
            --gradient: linear-gradient(135deg, #00ffcc, #0099ff);
        }
        body { margin: 0; background: #000; color: #fff; font-family: 'Segoe UI', sans-serif; height: 100vh; display: flex; justify-content: center; align-items: center; overflow: hidden; }
        
        /* Device Styling */
        .device { 
            width: 360px; height: 740px; background: var(--bg); border: 8px solid #222; border-radius: 40px; 
            position: relative; display: flex; flex-direction: column; transition: 0.4s ease; box-shadow: 0 0 50px rgba(0,255,204,0.2);
        }
        .laptop-mode { width: 95% !important; max-width: 1100px; height: 85% !important; border-radius: 15px !important; }

        /* Layouts */
        .status-bar { display: flex; justify-content: space-between; padding: 15px 25px 5px; font-size: 11px; color: var(--main); }
        .header { display: flex; justify-content: space-between; align-items: center; padding: 10px 20px; border-bottom: 1px solid #222; background: rgba(255,255,255,0.03); }
        .main-container { display: flex; flex: 1; overflow: hidden; }
        .player-side { flex: 2; display: flex; flex-direction: column; align-items: center; padding: 20px; overflow-y: auto; text-align: center; }
        .playlist-side { flex: 1; background: var(--panel); border-left: 1px solid #222; display: none; overflow-y: auto; padding: 15px; }
        .laptop-mode .playlist-side { display: block !important; }

        /* Media Display */
        .display-area { width: 100%; max-width: 450px; height: 230px; background: #000; border-radius: 15px; margin: 15px 0; display: flex; align-items: center; justify-content: center; border: 1px solid #333; position: relative; overflow: hidden; }
        #vid-p, #img-p { width: 100%; height: 100%; object-fit: contain; display: none; }
        .music-anim { width: 100px; height: 100px; border-radius: 50%; border: 4px solid var(--main); animation: pulse 2s infinite; display: flex; align-items: center; justify-content: center; font-size: 40px; }
        @keyframes pulse { 0% {box-shadow: 0 0 0 0 rgba(0,255,204,0.7);} 70% {box-shadow: 0 0 0 20px rgba(0,255,204,0);} 100% {box-shadow: 0 0 0 0 rgba(0,255,204,0);} }

        /* Controls */
        .controls { display: flex; align-items: center; gap: 25px; margin-top: 15px; }
        .p-btn { width: 60px; height: 60px; border-radius: 50%; background: var(--gradient); border: none; font-size: 25px; cursor: pointer; color: #000; }
        .seek-bar { width: 90%; margin: 15px 0; accent-color: var(--main); }

        /* Buttons & Menu */
        .btn-group { display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; margin-top: 10px; }
        .f-btn { background: #222; border: 1px solid #444; color: #fff; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 12px; }
        .f-btn:hover { border-color: var(--main); }
        #drop-menu { position: absolute; top: 60px; right: 15px; background: #111; border: 1px solid var(--main); border-radius: 10px; display: none; flex-direction: column; z-index: 5000; width: 180px; }
        .m-item { padding: 12px; font-size: 13px; border-bottom: 1px solid #222; cursor: pointer; }

        /* Overlays */
        .overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.95); z-index: 9000; display: none; align-items: center; justify-content: center; padding: 20px; }
        .card { background: #1a1a1a; padding: 25px; border-radius: 20px; border: 1px solid var(--main); width: 100%; max-width: 300px; }
        input { width: 100%; padding: 12px; margin: 8px 0; background: #000; border: 1px solid #333; color: #fff; border-radius: 8px; box-sizing: border-box; }
        
        .list-item { padding: 10px; border-bottom: 1px solid #333; cursor: pointer; font-size: 13px; transition: 0.2s; }
        .list-item:hover { background: #222; color: var(--main); }
    </style>
</head>
<body>

<div class="device" id="frame">
    <div class="status-bar">
        <span id="clock">00:00</span>
        <span id="bat-val">BAT: --%</span>
    </div>

    <div id="auth-box" class="overlay" style="display: flex;">
        <div class="card">
            <h3 style="color:var(--main); margin-top:0;">MI Pro Login</h3>
            <input type="text" id="u-name" placeholder="Full Name">
            <input type="number" id="u-phone" placeholder="Mobile Number">
            <input type="password" id="u-pass" placeholder="Password">
            <button class="p-btn" style="width:100%; border-radius:10px; font-size:16px;" onclick="doAuth()">Login / Sign Up</button>
        </div>
    </div>

    <div id="upi-box" class="overlay">
        <div class="card" style="text-align: center;">
            <h3 style="color:var(--main);">Support Kaushal Ji</h3>
            <p style="font-size:12px;">ID: mandavikaushal913@okaxis</p>
            <div style="background:#fff; padding:10px; display:inline-block; border-radius:10px;">
                <img src="https://api.qrserver.com/v1/create-qr-code/?size=140x140&data=upi://pay?pa=mandavikaushal913@okaxis&pn=Kaushal%20Ji" width="140">
            </div>
            <button class="f-btn" style="width:100%; margin-top:15px;" onclick="hidePop()">Close</button>
        </div>
    </div>

    <div class="header">
        <div id="pfp" style="width:35px; height:35px; border-radius:50%; background:#333; overflow:hidden;">üë§</div>
        <div style="text-align:center;">
            <b style="font-size:13px; color:var(--main);">MI PLAYER PRO</b>
            <select onchange="setView(this.value)" style="background:none; border:none; color:#888; font-size:10px; display:block; margin:auto;">
                <option value="mobile">Mobile View</option>
                <option value="laptop">Laptop View</option>
            </select>
        </div>
        <div onclick="toggleMenu(event)" style="cursor:pointer; color:var(--main); font-weight:bold; font-size:20px;">‚ãÆ</div>
    </div>

    <div id="drop-menu">
        <div class="m-item" onclick="window.open('https://wa.me/919129191898')">üí¨ WhatsApp</div>
        <div class="m-item" onclick="window.location.href='tel:9129191898'">üìû Call Support</div>
        <div class="m-item" onclick="showUPI()">üí∞ Support (UPI)</div>
        <div class="m-item" onclick="shareApp()">üì§ Share App</div>
        <div class="m-item" style="color:red;" onclick="location.reload()">üì¥ Logout</div>
    </div>

    <div class="main-container">
        <div class="player-side">
            <div id="user-welcome" style="font-weight:bold; font-size:18px;">Welcome User</div>
            <div id="track-title" style="color:#888; font-size:12px; margin-top:5px;">No Media Playing</div>

            <div class="display-area">
                <div id="music-ui" class="music-anim">üéµ</div>
                <video id="vid-p" controls></video>
                <img id="img-p">
            </div>

            <input type="range" id="seek" class="seek-bar" value="0">
            
            <div class="controls">
                <button onclick="changeTrack(-1)" style="background:none; border:none; color:#fff; font-size:25px;">‚èÆ</button>
                <button id="play-trigger" class="p-btn" onclick="handlePlay()">‚ñ∂</button>
                <button onclick="changeTrack(1)" style="background:none; border:none; color:#fff; font-size:25px;">‚è≠</button>
            </div>

            <div class="btn-group">
                <label class="f-btn">üéµ Audio <input type="file" hidden multiple accept="audio/*" onchange="importFiles(event, 'audio')"></label>
                <label class="f-btn">üé• Video <input type="file" hidden multiple accept="video/*" onchange="importFiles(event, 'video')"></label>
                <label class="f-btn">üñº Image <input type="file" hidden multiple accept="image/*" onchange="importFiles(event, 'image')"></label>
            </div>
            
            <div id="mobile-playlist" style="width:100%; margin-top:20px; text-align:left; display:block;">
                <b style="font-size:12px; color:var(--main);">Quick Playlist</b>
                <div id="m-list-cont"></div>
            </div>
        </div>

        <div class="playlist-side" id="side-list">
            <b style="color:var(--main); display:block; margin-bottom:10px;">Master Playlist</b>
            <div id="l-list-cont"></div>
        </div>
    </div>
</div>

<script>
    // Firebase Config
    const firebaseConfig = {
        apiKey: "AIzaSyDQ0Y8M9OGSInOlUltuysgmKOYGKX8dQvg",
        databaseURL: "https://calculator-by-kaushalji-default-rtdb.firebaseio.com",
        projectId: "calculator-by-kaushalji",
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let playlist = [], cursor = 0, currentUser = null;
    let audio = new Audio();
    let video = document.getElementById('vid-p');
    let active = audio;

    // --- Authentication ---
    async function doAuth() {
        const n = document.getElementById('u-name').value;
        const p = document.getElementById('u-phone').value;
        const pw = document.getElementById('u-pass').value;

        if(!p || !pw) return alert("Phone & Password required!");

        const snap = await db.ref('users/' + p).once('value');
        if(snap.exists()) {
            const data = snap.val();
            if(data.password === pw) startSession(data);
            else alert("Wrong password!");
        } else {
            const newUser = { name: n || "Elite User", phone: p, password: pw };
            await db.ref('users/' + p).set(newUser);
            startSession(newUser);
        }
    }

    function startSession(user) {
        currentUser = user;
        document.getElementById('user-welcome').innerText = user.name;
        document.getElementById('auth-box').style.display = 'none';
        syncCloud();
    }

    // --- Media Core ---
    function importFiles(e, type) {
        const files = Array.from(e.target.files);
        files.forEach(file => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => {
                const item = { name: file.name, url: reader.result, type: type };
                playlist.push(item);
                if(currentUser) db.ref('playlists/' + currentUser.phone).push(item);
                renderLists();
            };
        });
    }

    function syncCloud() {
        db.ref('playlists/' + currentUser.phone).on('value', snap => {
            playlist = [];
            snap.forEach(child => { playlist.push(child.val()); });
            renderLists();
        });
    }

    function renderLists() {
        const conts = [document.getElementById('m-list-cont'), document.getElementById('l-list-cont')];
        conts.forEach(c => {
            c.innerHTML = "";
            playlist.forEach((item, i) => {
                const d = document.createElement('div');
                d.className = 'list-item';
                d.innerHTML = (item.type === 'audio' ? 'üéµ ' : item.type === 'video' ? 'üé• ' : 'üñº ') + item.name;
                d.onclick = () => loadTrack(i);
                c.appendChild(d);
            });
        });
    }

    function loadTrack(i) {
        cursor = i;
        const item = playlist[i];
        audio.pause(); video.pause();
        document.getElementById('music-ui').style.display = 'none';
        document.getElementById('vid-p').style.display = 'none';
        document.getElementById('img-p').style.display = 'none';
        document.getElementById('track-title').innerText = item.name;

        if(item.type === 'audio') {
            document.getElementById('music-ui').style.display = 'flex';
            active = audio; audio.src = item.url; audio.play();
        } else if(item.type === 'video') {
            document.getElementById('vid-p').style.display = 'block';
            active = video; video.src = item.url; video.play();
        } else {
            document.getElementById('img-p').style.display = 'block';
            document.getElementById('img-p').src = item.url;
            active = { paused: true, play: ()=>{}, pause: ()=>{} };
        }
        document.getElementById('play-trigger').innerText = '‚è∏';
    }

    function handlePlay() {
        if(active.paused) { active.play(); document.getElementById('play-trigger').innerText = '‚è∏'; }
        else { active.pause(); document.getElementById('play-trigger').innerText = '‚ñ∂'; }
    }

    function changeTrack(dir) {
        cursor += dir;
        if(cursor >= 0 && cursor < playlist.length) loadTrack(cursor);
    }

    // --- System & UI ---
    function setView(v) {
        const f = document.getElementById('frame');
        v === 'laptop' ? f.classList.add('laptop-mode') : f.classList.remove('laptop-mode');
        document.getElementById('mobile-playlist').style.display = v === 'laptop' ? 'none' : 'block';
    }

    function toggleMenu(e) { e.stopPropagation(); const m = document.getElementById('drop-menu'); m.style.display = (m.style.display === 'flex') ? 'none' : 'flex'; }
    function showUPI() { document.getElementById('upi-box').style.display = 'flex'; }
    function hidePop() { document.querySelectorAll('.overlay').forEach(o => { if(o.id !== 'auth-box') o.style.display='none'; }); }

    // Battery & Clock
    setInterval(() => {
        const d = new Date();
        document.getElementById('clock').innerText = d.getHours() + ":" + String(d.getMinutes()).padStart(2,'0');
        if(navigator.getBattery) {
            navigator.getBattery().then(b => {
                document.getElementById('bat-val').innerText = "BAT: " + Math.round(b.level * 100) + "%";
            });
        }
    }, 1000);

    function shareApp() {
        if(navigator.share) navigator.share({ title: 'MI PLAYER PRO', url: window.location.href });
        else alert("Link: " + window.location.href);
    }

    window.onclick = () => document.getElementById('drop-menu').style.display='none';
    
    // Seek Bar Logic
    active.ontimeupdate = () => {
        const s = document.getElementById('seek');
        if(active.duration) {
            s.max = active.duration;
            s.value = active.currentTime;
        }
    };
    document.getElementById('seek').oninput = (e) => { active.currentTime = e.target.value; };
</script>
</body>
</html>
