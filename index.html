<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MI PLAYER PRO - Firebase Elite</title>
    <link rel="manifest" href="manifest.json">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root { 
            --p-width: 350px; --p-height: 700px; 
            --main-clr: #00ffcc; --bg-dark: #080808;
            --glass-border: rgba(255, 255, 255, 0.1);
            --hacker-green: #00ff41;
            --accent-gradient: linear-gradient(135deg, #00ffcc 0%, #0099ff 100%);
        }

        body { 
            margin: 0; background: radial-gradient(circle at center, #1a1a1a, #000); 
            display: flex; justify-content: center; align-items: center; 
            height: 100vh; font-family: 'Segoe UI', Roboto, sans-serif; 
            color: #fff; overflow: hidden; 
        }
        
        .phone { 
            width: var(--p-width); height: var(--p-height); 
            background: rgba(8, 8, 8, 0.95); border: 8px solid #1a1a1a; 
            border-radius: 45px; position: relative; overflow: hidden; 
            box-shadow: 0 0 50px rgba(0, 255, 204, 0.15);
            backdrop-filter: blur(20px);
        }

        /* Original Visualizer */
        .visualizer-container { position: relative; width: 180px; height: 180px; display: flex; align-items: center; justify-content: center; margin: 15px 0; }
        #v-canvas { position: absolute; width: 100%; height: 100%; }
        .image-container { width: 100px; height: 100px; border-radius: 50%; overflow: hidden; border: 3px solid var(--main-clr); z-index: 2; background: #000; transition: 0.1s ease; }
        
        /* Dropdown Menu */
        .menu-dots { position: absolute; top: 60px; right: 20px; background: #111; border: 1px solid var(--main-clr); border-radius: 15px; display: none; z-index: 1000; overflow: hidden; width: 150px; }
        .menu-dots button { width: 100%; padding: 12px; text-align: left; font-size: 12px; color: white; border-bottom: 1px solid #222; }
        .menu-dots button:hover { background: var(--main-clr); color: black; }

        /* Calculator Layer */
        #calc-layer { position: absolute; inset: 0; background: #080808; z-index: 800; display: none; flex-direction: column; padding: 30px 20px; }
        .btn-calc { background: rgba(255,255,255,0.05); border-radius: 15px; height: 55px; font-weight: bold; font-size: 1.2rem; }
        .btn-calc:active { background: var(--main-clr); color: black; }

        /* Overlays */
        .overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.9); z-index: 1500; display: none; flex-direction: column; align-items: center; justify-content: center; backdrop-filter: blur(15px); padding: 20px; }
        .card { background: #111; padding: 25px; border-radius: 25px; width: 100%; border: 1px solid var(--main-clr); }
        
        input { width: 100%; padding: 12px; margin: 8px 0; background: #000; border: 1px solid #333; color: #fff; border-radius: 12px; outline: none; }
        .btn-main { width: 100%; padding: 14px; background: var(--accent-gradient); border: none; border-radius: 12px; font-weight: bold; color: #000; margin-top: 10px; }
    </style>
</head>
<body>

<div class="phone" id="main-frame">
    <header class="pt-12 px-6 flex justify-between items-center z-50">
        <div class="flex items-center gap-3" onclick="openAuth()">
            <div id="user-pic-box" class="w-10 h-10 rounded-full border border-main-clr overflow-hidden bg-black flex items-center justify-center">
                <i class="fas fa-user text-main-clr"></i>
            </div>
            <div>
                <p class="text-[10px] font-bold uppercase" id="u-name">Guest User</p>
                <p class="text-[8px] text-main-clr">ELITE EDITION</p>
            </div>
        </div>
        <div class="relative">
            <button onclick="toggleDots()" class="text-white text-xl p-2"><i class="fas fa-ellipsis-v"></i></button>
            <div id="dots-menu" class="menu-dots">
                <button onclick="showUI('calc')"><i class="fas fa-calculator mr-2"></i> Calculator</button>
                <button onclick="showUI('player')"><i class="fas fa-play mr-2"></i> Player Mode</button>
                <button onclick="openAuth()"><i class="fas fa-user-shield mr-2"></i> Firebase Account</button>
            </div>
        </div>
    </header>

    <div id="player-ui" class="flex-1 flex flex-col items-center p-4">
        <div class="visualizer-container">
            <canvas id="v-canvas"></canvas>
            <div class="image-container" id="p-circle">
                <img id="track-art" style="display:none; width:100%; height:100%; object-fit:cover;">
                <div class="text-4xl mt-6">ðŸŽµ</div>
            </div>
        </div>

        <div id="vid-box" class="w-full h-44 bg-black rounded-2xl border border-white/10 mb-4 hidden overflow-hidden">
            <video id="vid-p" playsinline></video>
        </div>

        <h4 id="track-name" class="text-sm font-bold text-gray-400 text-center truncate w-64 mb-6">No Media Loaded</h4>
        
        <input type="range" id="seek-slider" class="w-[85%] accent-main-clr mb-2" value="0">
        <div class="flex justify-between w-[85%] text-[10px] text-main-clr font-mono">
            <span id="curr-time">0:00</span> <span id="dur-time">0:00</span>
        </div>

        <div class="flex items-center gap-10 my-8">
            <button onclick="prevT()" class="text-2xl"><i class="fas fa-step-backward"></i></button>
            <button id="play-btn" onclick="togglePlay()" class="w-16 h-16 rounded-full bg-main-clr text-black flex items-center justify-center text-2xl shadow-lg">
                <i class="fas fa-play"></i>
            </button>
            <button onclick="nextT()" class="text-2xl"><i class="fas fa-step-forward"></i></button>
        </div>

        <div class="flex gap-4">
            <label class="bg-white/5 px-6 py-3 rounded-2xl text-[10px] font-bold cursor-pointer border border-white/10"><input type="file" multiple accept="audio/*" class="hidden" onchange="loadFiles(event, 'music')">AUDIO</label>
            <label class="bg-white/5 px-6 py-3 rounded-2xl text-[10px] font-bold cursor-pointer border border-white/10"><input type="file" multiple accept="video/*" class="hidden" onchange="loadFiles(event, 'video')">VIDEO</label>
        </div>
    </div>

    <div id="calc-layer">
        <div class="text-right mb-6 mt-4">
            <p id="calc-history" class="text-[10px] text-main-clr/30 font-mono h-4">> Secure Mode</p>
            <h1 id="calc-display" class="text-6xl font-light truncate">0</h1>
        </div>
        <div class="grid grid-cols-4 gap-3">
            <button onclick="cls()" class="btn-calc text-red-500">C</button>
            <button onclick="del()" class="btn-calc"><i class="fas fa-backspace"></i></button>
            <button onclick="ins('/')" class="btn-calc text-main-clr">Ã·</button>
            <button onclick="ins('*')" class="btn-calc text-main-clr">Ã—</button>
            <button onclick="ins('7')" class="btn-calc">7</button>
            <button onclick="ins('8')" class="btn-calc">8</button>
            <button onclick="ins('9')" class="btn-calc">9</button>
            <button onclick="ins('-')" class="btn-calc text-main-clr">âˆ’</button>
            <button onclick="ins('4')" class="btn-calc">4</button>
            <button onclick="ins('5')" class="btn-calc">5</button>
            <button onclick="ins('6')" class="btn-calc">6</button>
            <button onclick="ins('+')" class="btn-calc text-main-clr">+</button>
            <button onclick="ins('1')" class="btn-calc">1</button>
            <button onclick="ins('2')" class="btn-calc">2</button>
            <button onclick="ins('3')" class="btn-calc">3</button>
            <button onclick="exe()" class="btn-calc bg-main-clr text-black">=</button>
            <button onclick="ins('0')" class="btn-calc col-span-2">0</button>
            <button onclick="ins('.')" class="btn-calc">.</button>
        </div>
        <button onclick="showUI('player')" class="mt-8 text-[10px] text-gray-600 uppercase tracking-widest">Back to Player</button>
    </div>

    <div id="auth-modal" class="overlay">
        <div class="card">
            <h3 id="auth-title" class="text-main-clr font-black text-center mb-4">MI AUTH</h3>
            <input type="email" id="auth-email" placeholder="Email Address">
            <input type="password" id="auth-pass" placeholder="Password">
            <div id="reg-fields" class="hidden">
                <input type="text" id="auth-name" placeholder="Full Name">
            </div>
            <button class="btn-main" onclick="handleAuth()">PROCEED</button>
            <p class="text-[10px] text-center mt-4 text-gray-500 cursor-pointer" onclick="toggleAuth()">Toggle Login / Register</p>
            <button onclick="document.getElementById('auth-modal').style.display='none'" class="w-full text-[10px] mt-4 text-red-500">Close</button>
        </div>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, updateProfile } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDQ0Y8M9OGSInOlUltuysgmKOYGKX8dQvg",
        authDomain: "calculator-by-kaushalji.firebaseapp.com",
        projectId: "calculator-by-kaushalji",
        appId: "1:156130281294:web:73b80a5f344daeabdd001f"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    window.auth = auth;

    let isLogin = true;
    window.toggleAuth = () => {
        isLogin = !isLogin;
        document.getElementById('auth-title').innerText = isLogin ? "MI LOGIN" : "MI REGISTRATION";
        document.getElementById('reg-fields').classList.toggle('hidden');
    };

    window.handleAuth = async () => {
        const email = document.getElementById('auth-email').value;
        const pass = document.getElementById('auth-pass').value;
        try {
            if(isLogin) {
                await signInWithEmailAndPassword(auth, email, pass);
            } else {
                const name = document.getElementById('auth-name').value;
                const res = await createUserWithEmailAndPassword(auth, email, pass);
                await updateProfile(res.user, { displayName: name });
            }
            document.getElementById('auth-modal').style.display = 'none';
        } catch(e) { alert(e.message); }
    };

    onAuthStateChanged(auth, user => {
        if(user) {
            document.getElementById('u-name').innerText = user.displayName || user.email.split('@')[0];
        }
    });
</script>

<script>
    // System Variables
    let playlist = [], trackIdx = 0, currentMode = 'music';
    let audioMedia = new Audio(), videoEl = document.getElementById('vid-p'), activeMedia = audioMedia;
    let audioCtx, analyser, vCanvas, vCtx;

    // UI Logic
    function toggleDots() { 
        const m = document.getElementById('dots-menu');
        m.style.display = m.style.display === 'block' ? 'none' : 'block'; 
    }
    
    function showUI(mode) {
        document.getElementById('dots-menu').style.display = 'none';
        document.getElementById('player-ui').style.display = (mode === 'player') ? 'flex' : 'none';
        document.getElementById('calc-layer').style.display = (mode === 'calc') ? 'flex' : 'none';
    }

    function openAuth() { document.getElementById('auth-modal').style.display = 'flex'; }

    // Calculator Logic
    const cDisp = document.getElementById('calc-display');
    function ins(v) { if(cDisp.innerText === '0') cDisp.innerText = v; else cDisp.innerText += v; }
    function cls() { cDisp.innerText = '0'; }
    function del() { cDisp.innerText = cDisp.innerText.length > 1 ? cDisp.innerText.slice(0, -1) : '0'; }
    function exe() {
        try { cDisp.innerText = eval(cDisp.innerText.replace(/Ã—/g, '*').replace(/Ã·/g, '/')); } 
        catch { cDisp.innerText = "Error"; }
    }

    // Player Logic (From VLC Player File)
    function loadFiles(e, mode) {
        playlist = Array.from(e.target.files);
        currentMode = mode;
        document.getElementById('vid-box').style.display = mode === 'video' ? 'block' : 'none';
        document.getElementById('v-canvas').parentElement.style.display = mode === 'music' ? 'flex' : 'none';
        if(playlist.length > 0) playT(0);
    }

    function playT(i) {
        trackIdx = i; activeMedia.pause();
        const url = URL.createObjectURL(playlist[i]);
        document.getElementById('track-name').innerText = playlist[i].name;
        if(currentMode === 'video') { activeMedia = videoEl; videoEl.src = url; videoEl.play(); }
        else { activeMedia = audioMedia; audioMedia.src = url; audioMedia.play(); }
        initVisualizer();
        document.getElementById('play-btn').innerHTML = '<i class="fas fa-pause"></i>';
    }

    function togglePlay() {
        if(activeMedia.paused) { activeMedia.play(); document.getElementById('play-btn').innerHTML = '<i class="fas fa-pause"></i>'; }
        else { activeMedia.pause(); document.getElementById('play-btn').innerHTML = '<i class="fas fa-play"></i>'; }
    }

    function nextT() { if(trackIdx < playlist.length - 1) playT(trackIdx + 1); }
    function prevT() { if(trackIdx > 0) playT(trackIdx - 1); }

    function initVisualizer() {
        if (audioCtx) return;
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        analyser = audioCtx.createAnalyser();
        const sA = audioCtx.createMediaElementSource(audioMedia);
        const sV = audioCtx.createMediaElementSource(videoEl);
        sA.connect(analyser); sV.connect(analyser);
        analyser.connect(audioCtx.destination);
        vCanvas = document.getElementById('v-canvas'); vCtx = vCanvas.getContext('2d');
        vCanvas.width = 180; vCanvas.height = 180;
        draw();
    }

    function draw() {
        requestAnimationFrame(draw);
        let array = new Uint8Array(analyser.frequencyBinCount);
        analyser.getByteFrequencyData(array);
        vCtx.clearRect(0, 0, 180, 180);
        for (let i = 0; i < 60; i++) {
            let h = array[i] / 5;
            let angle = (i * 2 * Math.PI) / 60;
            vCtx.strokeStyle = '#00ffcc';
            vCtx.lineWidth = 2.5; vCtx.beginPath();
            vCtx.moveTo(90 + Math.cos(angle)*50, 90 + Math.sin(angle)*50);
            vCtx.lineTo(90 + Math.cos(angle)*(50+h), 90 + Math.sin(angle)*(50+h));
            vCtx.stroke();
        }
        document.getElementById('p-circle').style.transform = `scale(${1 + array[10]/600})`;
    }

    // Time Update
    activeMedia.ontimeupdate = () => {
        document.getElementById('seek-slider').max = activeMedia.duration || 0;
        document.getElementById('seek-slider').value = activeMedia.currentTime;
        document.getElementById('curr-time').innerText = formatTime(activeMedia.currentTime);
        document.getElementById('dur-time').innerText = formatTime(activeMedia.duration);
    };
    function formatTime(s) { let m=Math.floor(s/60), sec=Math.floor(s%60); return `${m}:${sec<10?'0':''}${sec}`; }
    document.getElementById('seek-slider').oninput = function() { activeMedia.currentTime = this.value; };
</script>
</body>
</html>
