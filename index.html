<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>MI PLAYER PRO - Elite Hybrid</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#080808">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root { 
            --p-width: 350px; --p-height: 700px; 
            --main-clr: #00ffcc; --bg-dark: #080808;
            --hacker-green: #00ff41;
            --accent-gradient: linear-gradient(135deg, #00ffcc 0%, #0099ff 100%);
        }

        body { 
            margin: 0; background: radial-gradient(circle at center, #1a1a1a, #000); 
            display: flex; justify-content: center; align-items: center; 
            height: 100vh; font-family: 'Segoe UI', sans-serif; 
            color: #fff; overflow: hidden; 
        }
        
        .phone { 
            width: var(--p-width); height: var(--p-height); 
            background: rgba(8, 8, 8, 0.95); border: 8px solid #1a1a1a; 
            border-radius: 45px; position: relative; overflow: hidden; 
            box-shadow: 0 0 50px rgba(0, 255, 204, 0.15);
            backdrop-filter: blur(20px);
        }

        /* Calculator Keys */
        .btn-calc { background: rgba(255, 255, 255, 0.05); border-radius: 1.2rem; font-weight: 800; font-size: 1.2rem; transition: 0.1s; color: white;}
        .btn-calc:active { transform: scale(0.9); background: var(--main-clr); color: #000; }

        /* Existing MI Player Styles */
        .visualizer-container { position: relative; width: 180px; height: 180px; display: flex; align-items: center; justify-content: center; margin: 15px 0; }
        #v-canvas { position: absolute; width: 100%; height: 100%; }
        .image-container { width: 100px; height: 100px; border-radius: 50%; overflow: hidden; border: 3px solid var(--main-clr); z-index: 2; background: #000; }
        
        .overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.9); z-index: 1000; display: none; flex-direction: column; align-items: center; justify-content: center; backdrop-filter: blur(15px); padding: 20px; }
        .card { background: #111; padding: 25px; border-radius: 25px; width: 100%; border: 1px solid var(--main-clr); }
        
        input { width: 100%; padding: 12px; margin: 8px 0; background: #000; border: 1px solid #333; color: #fff; border-radius: 12px; outline: none; }
        .playlist-sidebar { position: absolute; right: -100%; top: 0; width: 80%; height: 100%; background: #050505; z-index: 500; transition: 0.4s; border-left: 1px solid var(--main-clr); overflow-y: auto; }
        .playlist-sidebar.active { right: 0; }
        
        #shadow-os { position: fixed; inset: 0; background: #000; z-index: 2000; display: none; padding: 30px; font-family: 'Courier New', monospace; color: var(--hacker-green); }
    </style>
</head>
<body>

<div class="phone" id="main-frame">
    <header class="pt-12 px-6 flex justify-between items-center">
        <div class="flex items-center gap-3" onclick="openAuth()">
            <div id="u-img" class="w-10 h-10 rounded-full border border-main-clr overflow-hidden flex items-center justify-center bg-black">
                <i class="fas fa-user-circle text-main-clr"></i>
            </div>
            <div>
                <p class="text-[10px] font-bold" id="u-name-display">Guest User</p>
                <p class="text-[8px] text-main-clr">MI-ENCRYPTED</p>
            </div>
        </div>
        <button onclick="toggleSidebar()" class="text-main-clr text-xl"><i class="fas fa-bars"></i></button>
    </header>

    <div id="calc-ui" class="flex-1 flex flex-col p-6 mt-4">
        <div class="text-right mb-6">
            <div id="history" class="text-[9px] text-main-clr/40 h-12 overflow-hidden text-left">> System Ready...</div>
            <h1 id="display" class="text-6xl font-light truncate">0</h1>
        </div>
        <div class="grid grid-cols-4 gap-3">
            <button onclick="cls()" class="btn-calc h-14 text-red-500">AC</button>
            <button onclick="del()" class="btn-calc h-14">‚å´</button>
            <button onclick="ins('/')" class="btn-calc h-14">√∑</button>
            <button onclick="ins('*')" class="btn-calc h-14">√ó</button>
            <button onclick="ins('7')" class="btn-calc h-14">7</button>
            <button onclick="ins('8')" class="btn-calc h-14">8</button>
            <button onclick="ins('9')" class="btn-calc h-14">9</button>
            <button onclick="ins('-')" class="btn-calc h-14">‚àí</button>
            <button onclick="ins('4')" class="btn-calc h-14">4</button>
            <button onclick="ins('5')" class="btn-calc h-14">5</button>
            <button onclick="ins('6')" class="btn-calc h-14">6</button>
            <button onclick="ins('+')" class="btn-calc h-14">+</button>
            <button onclick="ins('1')" class="btn-calc h-14">1</button>
            <button onclick="ins('2')" class="btn-calc h-14">2</button>
            <button onclick="ins('3')" class="btn-calc h-14">3</button>
            <button onclick="exe()" class="btn-calc h-14 bg-main-clr text-black">=</button>
            <button onclick="ins('0')" class="btn-calc h-14 col-span-2">0</button>
            <button onclick="ins('.')" class="btn-calc h-14">.</button>
        </div>
    </div>

    <div id="player-ui" class="flex-1 flex flex-col items-center px-4 hidden">
        <div class="visualizer-container">
            <canvas id="v-canvas"></canvas>
            <div class="image-container" id="p-circle">
                <img id="profile-img" style="display:none; width:100%; height:100%; object-fit:cover;">
                <div id="default-icon" class="text-4xl mt-6 text-center">üéµ</div>
            </div>
        </div>

        <div id="vid-box" class="w-full h-40 bg-black rounded-2xl overflow-hidden border border-white/10 hidden">
            <video id="vid-p" playsinline></video>
        </div>

        <h4 id="track-name" class="mt-4 text-[12px] text-gray-400 text-center truncate w-full px-6">No Media</h4>
        
        <input type="range" id="seek-slider" class="w-full mt-4 accent-main-clr" value="0">
        
        <div class="flex items-center gap-8 my-6">
            <button onclick="prevT()" class="text-2xl">‚èÆ</button>
            <button id="play-btn" class="w-14 h-14 rounded-full bg-main-clr text-black flex items-center justify-center text-xl" onclick="togglePlay()">‚ñ∂</button>
            <button onclick="nextT()" class="text-2xl">‚è≠</button>
        </div>

        <div class="flex gap-2">
            <label class="bg-white/5 p-3 rounded-xl text-[10px] cursor-pointer"><input type="file" multiple accept="audio/*" class="hidden" onchange="loadFiles(event, 'music')">AUDIO</label>
            <label class="bg-white/5 p-3 rounded-xl text-[10px] cursor-pointer"><input type="file" multiple accept="video/*" class="hidden" onchange="loadFiles(event, 'video')">VIDEO</label>
            <button onclick="switchMode('calc')" class="bg-red-900/20 p-3 rounded-xl text-[10px] text-red-500">LOCK</button>
        </div>
    </div>

    <div id="sidebar" class="playlist-sidebar">
        <div class="p-6">
            <h3 class="text-main-clr font-bold mb-4">PLAYLIST</h3>
            <div id="playlist-items" class="text-xs space-y-2"></div>
            <hr class="my-4 border-white/10">
            <button onclick="auth.signOut(); location.reload();" class="text-red-500 text-xs">Logout</button>
        </div>
    </div>

    <div id="auth-modal" class="overlay">
        <div class="card">
            <h3 id="auth-title" class="text-main-clr font-black text-center mb-4">MI LOGIN</h3>
            <input type="email" id="auth-email" placeholder="Email">
            <input type="password" id="auth-pass" placeholder="Password">
            <div id="reg-box" class="hidden">
                <input type="text" id="auth-name" placeholder="Full Name">
            </div>
            <button class="w-full bg-main-clr text-black p-3 rounded-xl font-bold mt-4" onclick="handleAuth()">CONTINUE</button>
            <p class="text-[10px] text-center mt-4 text-gray-500 cursor-pointer" onclick="toggleAuth()">New account? Register</p>
            <button onclick="document.getElementById('auth-modal').style.display='none'" class="w-full text-[10px] mt-2 text-red-500">Cancel</button>
        </div>
    </div>
</div>

<div id="shadow-os">
    <div id="h-results"></div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, updateProfile } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    const firebaseConfig = {
        apiKey: "AIzaSyDQ0Y8M9OGSInOlUltuysgmKOYGKX8dQvg",
        authDomain: "calculator-by-kaushalji.firebaseapp.com",
        projectId: "calculator-by-kaushalji",
        appId: "1:156130281294:web:73b80a5f344daeabdd001f"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    window.auth = auth;

    let isLogin = true;
    window.toggleAuth = () => {
        isLogin = !isLogin;
        document.getElementById('auth-title').innerText = isLogin ? "MI LOGIN" : "MI REGISTER";
        document.getElementById('reg-box').classList.toggle('hidden');
    };

    window.handleAuth = async () => {
        const email = document.getElementById('auth-email').value;
        const pass = document.getElementById('auth-pass').value;
        try {
            if(isLogin) {
                await signInWithEmailAndPassword(auth, email, pass);
            } else {
                const name = document.getElementById('auth-name').value;
                const res = await createUserWithEmailAndPassword(auth, email, pass);
                await updateProfile(res.user, { displayName: name });
            }
            document.getElementById('auth-modal').style.display = 'none';
        } catch(e) { alert(e.message); }
    };

    onAuthStateChanged(auth, user => {
        if(user) {
            document.getElementById('u-name-display').innerText = user.displayName || user.email.split('@')[0];
        }
    });
</script>

<script>
    // Hybrid System Logic
    let playlist = [], trackIdx = 0, currentMode = 'music';
    let audioMedia = new Audio(), videoEl = document.getElementById('vid-p'), activeMedia = audioMedia;
    let audioCtx, analyser, vCanvas, vCtx;

    // Calculator Functions
    const display = document.getElementById('display');
    function ins(v) { if(display.innerText === '0') display.innerText = v; else display.innerText += v; }
    function cls() { display.innerText = '0'; }
    function del() { display.innerText = display.innerText.length > 1 ? display.innerText.slice(0, -1) : '0'; }
    
    function exe() {
        if(display.innerText === "1234") { switchMode('player'); display.innerText = "0"; return; }
        if(display.innerText === "9999") { runHacker(); display.innerText = "0"; return; }
        try { display.innerText = eval(display.innerText.replace(/√ó/g, '*').replace(/√∑/g, '/')); } 
        catch { display.innerText = "Error"; }
    }

    function switchMode(mode) {
        document.getElementById('calc-ui').classList.toggle('hidden', mode === 'player');
        document.getElementById('player-ui').classList.toggle('hidden', mode === 'calc');
    }

    // Player Logic
    function loadFiles(e, mode) {
        playlist = Array.from(e.target.files);
        currentMode = mode;
        document.getElementById('vid-box').style.display = mode === 'video' ? 'block' : 'none';
        if(playlist.length > 0) playT(0);
        renderPlaylist();
    }

    function playT(i) {
        trackIdx = i; activeMedia.pause();
        const url = URL.createObjectURL(playlist[i]);
        document.getElementById('track-name').innerText = playlist[i].name;
        
        if(currentMode === 'video') { activeMedia = videoEl; videoEl.src = url; videoEl.play(); }
        else { activeMedia = audioMedia; audioMedia.src = url; audioMedia.play(); }
        
        initVisualizer();
        document.getElementById('play-btn').innerText = '‚è∏';
    }

    function togglePlay() {
        if(activeMedia.paused) { activeMedia.play(); document.getElementById('play-btn').innerText = '‚è∏'; }
        else { activeMedia.pause(); document.getElementById('play-btn').innerText = '‚ñ∂'; }
    }

    function nextT() { if(trackIdx < playlist.length - 1) playT(trackIdx + 1); }
    function prevT() { if(trackIdx > 0) playT(trackIdx - 1); }

    function toggleSidebar() { document.getElementById('sidebar').classList.toggle('active'); }
    function openAuth() { document.getElementById('auth-modal').style.display = 'flex'; }

    // Visualizer (Original Engine)
    function initVisualizer() {
        if (audioCtx) return;
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
        analyser = audioCtx.createAnalyser();
        const sA = audioCtx.createMediaElementSource(audioMedia);
        const sV = audioCtx.createMediaElementSource(videoEl);
        sA.connect(analyser); sV.connect(analyser);
        analyser.connect(audioCtx.destination);
        vCanvas = document.getElementById('v-canvas'); vCtx = vCanvas.getContext('2d');
        vCanvas.width = 180; vCanvas.height = 180;
        draw();
    }

    function draw() {
        requestAnimationFrame(draw);
        let array = new Uint8Array(analyser.frequencyBinCount);
        analyser.getByteFrequencyData(array);
        vCtx.clearRect(0, 0, 180, 180);
        for (let i = 0; i < 60; i++) {
            let h = array[i] / 5;
            let angle = (i * 2 * Math.PI) / 60;
            vCtx.strokeStyle = '#00ffcc';
            vCtx.lineWidth = 2; vCtx.beginPath();
            vCtx.moveTo(90 + Math.cos(angle)*50, 90 + Math.sin(angle)*50);
            vCtx.lineTo(90 + Math.cos(angle)*(50+h), 90 + Math.sin(angle)*(50+h));
            vCtx.stroke();
        }
    }

    function runHacker() {
        document.getElementById('shadow-os').style.display = 'block';
        const res = document.getElementById('h-results');
        res.innerHTML = "[SYSTEM]: DECRYPTING FIREBASE...<br>";
        setTimeout(() => { res.innerHTML += "[SUCCESS]: ACCESS GRANTED."; }, 2000);
    }

    // PWA Service Worker Registration
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('sw.js');
    }
</script>
</body>
</html>
