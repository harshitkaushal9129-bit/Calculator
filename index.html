<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MI PLAYER PRO - Kaushal Ji</title>
    <link rel="manifest" href="manifest.json">
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
    :root { 
        --main: #00ffcc; --bg: #0a0a0a; --panel: #151515;
        --gradient: linear-gradient(135deg, #00ffcc, #0099ff);
    }
    body { margin: 0; background: #000; color: #fff; font-family: 'Segoe UI', sans-serif; height: 100vh; display: flex; justify-content: center; align-items: center; overflow: hidden; }
    
    .device { 
        width: 360px; height: 740px; background: var(--bg); border: 8px solid #222; border-radius: 40px; 
        position: relative; display: flex; flex-direction: column; transition: 0.4s ease; box-shadow: 0 0 50px rgba(0,255,204,0.2);
    }

    /* ‡§≤‡•à‡§™‡§ü‡•â‡§™ ‡§Æ‡•ã‡§° ‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏ */
    .laptop-mode { width: 95% !important; max-width: 1100px; height: 85% !important; border-radius: 15px !important; }
    .laptop-mode .main-container { flex-direction: row; } /* ‡§™‡•ç‡§≤‡•á‡§Ø‡§∞ ‡§≤‡•á‡§´‡•ç‡§ü, ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§∞‡§æ‡§á‡§ü */

    .status-bar { display: flex; justify-content: space-between; padding: 15px 25px 5px; font-size: 11px; color: var(--main); }
    .header { display: flex; justify-content: space-between; align-items: center; padding: 10px 15px; border-bottom: 1px solid #222; background: rgba(255,255,255,0.03); position: relative; }
    
    .icon-btn { width: 35px; height: 35px; border-radius: 50%; background: #222; border: 1px solid var(--main); display: flex; align-items: center; justify-content: center; cursor: pointer; overflow: hidden; font-size: 14px; }
    .icon-label { font-size: 8px; color: var(--main); display: block; margin-top: 2px; }

    .main-container { display: flex; flex: 1; overflow: hidden; }
    .player-side { flex: 2; display: flex; flex-direction: column; align-items: center; padding: 20px; overflow-y: auto; text-align: center; }

    /* ‡§™‡•ç‡§≤‡•á‡§≤‡§ø‡§∏‡•ç‡§ü: ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§Æ‡•á‡§Ç ‡§õ‡•Å‡§™‡•Ä ‡§∞‡§π‡•á‡§ó‡•Ä, ‡§∏‡§ø‡§∞‡•ç‡§´ ‡§≤‡•à‡§™‡§ü‡•â‡§™ ‡§Æ‡•ã‡§° ‡§Æ‡•á‡§Ç ‡§¶‡§æ‡§à‡§Ç ‡§ì‡§∞ ‡§¶‡§ø‡§ñ‡•á‡§ó‡•Ä */
    .playlist-side { flex: 1; background: var(--panel); border-left: 1px solid #222; display: none; overflow-y: auto; padding: 15px; }
    .laptop-mode .playlist-side { display: block !important; }
    
    /* ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§µ‡•ç‡§Ø‡•Ç ‡§ï‡•á ‡§®‡•Ä‡§ö‡•á ‡§µ‡§æ‡§≤‡•Ä ‡§™‡•ç‡§≤‡•á‡§≤‡§ø‡§∏‡•ç‡§ü ‡§ï‡•ã ‡§π‡§Æ‡•á‡§∂‡§æ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§¨‡§Ç‡§¶ ‡§ï‡§ø‡§Ø‡§æ */
    #mobile-playlist { display: none !important; }

    .display-area { width: 100%; max-width: 450px; height: 230px; background: #000; border-radius: 15px; margin: 15px 0; display: flex; align-items: center; justify-content: center; border: 1px solid #333; position: relative; overflow: hidden; }
    #vid-p, #img-p { width: 100%; height: 100%; object-fit: contain; display: none; }
    .music-anim { width: 100px; height: 100px; border-radius: 50%; border: 4px solid var(--main); animation: pulse 2s infinite; display: flex; align-items: center; justify-content: center; font-size: 40px; }
    @keyframes pulse { 0% {box-shadow: 0 0 0 0 rgba(0,255,204,0.7);} 70% {box-shadow: 0 0 0 20px rgba(0,255,204,0);} 100% {box-shadow: 0 0 0 0 rgba(0,255,204,0);} }

    .controls { display: flex; align-items: center; gap: 25px; margin-top: 15px; }
    .p-btn { width: 60px; height: 60px; border-radius: 50%; background: var(--gradient); border: none; font-size: 25px; cursor: pointer; color: #000; }
    .seek-bar { width: 90%; margin: 15px 0; accent-color: var(--main); }

    .btn-group { display: flex; gap: 8px; flex-wrap: wrap; justify-content: center; margin-top: 10px; }
    .f-btn { background: #222; border: 1px solid #444; color: #fff; padding: 8px 12px; border-radius: 8px; cursor: pointer; font-size: 12px; }
    
    .overlay { position: absolute; inset: 0; background: rgba(0,0,0,0.96); z-index: 9000; display: none; align-items: center; justify-content: center; padding: 20px; border-radius: 32px; }
    .card { background: #111; padding: 25px; border-radius: 20px; border: 1px solid var(--main); width: 100%; max-width: 280px; }
    input { width: 100%; padding: 12px; margin: 8px 0; background: #000; border: 1px solid #333; color: #fff; border-radius: 8px; box-sizing: border-box; }
    
    .list-item { padding: 10px; border-bottom: 1px solid #333; cursor: pointer; font-size: 13px; display: flex; justify-content: space-between; align-items: center; }
    .list-item:hover { background: rgba(255,255,255,0.05); }
    .del-btn { color: #ff4444; font-size: 16px; padding: 5px; cursor: pointer; }

    #drop-menu { position: absolute; top: 60px; right: 50px; background: #111; border: 1px solid var(--main); border-radius: 10px; display: none; flex-direction: column; z-index: 9999; width: 150px; }
    .m-item { padding: 12px; font-size: 12px; border-bottom: 1px solid #222; cursor: pointer; }
</style>

</head>
<body>

<div class="device" id="frame">
    <div class="status-bar">
        <span id="clock">00:00</span>
        <span id="bat-val">BAT: --%</span>
    </div>

    <div id="login-box" class="overlay">
        <div class="card">
            <h3 style="color:var(--main); margin-top:0;">Login</h3>
            <input type="number" id="l-phone" placeholder="Phone Number">
            <input type="password" id="l-pass" placeholder="Password">
            <button class="p-btn" style="width:100%; border-radius:10px; font-size:16px;" onclick="handleLogin()">Login</button>
            <button onclick="hidePop()" style="background:none; border:none; color:#555; width:100%; margin-top:10px;">Close</button>
        </div>
    </div>

    <div id="reg-box" class="overlay">
        <div class="card">
            <h3 style="color:var(--main); margin-top:0;">Register</h3>
            <input type="text" id="r-name" placeholder="Full Name">
            <input type="number" id="r-phone" placeholder="Phone Number">
            <input type="password" id="r-pass" placeholder="Create Password">
            <p style="font-size:9px; color:#888; margin:5px 0;">Profile Picture (Optional):</p>
            <input type="file" id="r-img" accept="image/*" style="font-size:10px;">
            <button class="p-btn" style="width:100%; border-radius:10px; font-size:16px;" onclick="handleRegister()">Sign Up</button>
            <button onclick="hidePop()" style="background:none; border:none; color:#555; width:100%; margin-top:10px;">Close</button>
        </div>
    </div>

    <div id="upi-box" class="overlay">
        <div class="card" style="text-align: center;">
            <h3 style="color:var(--main);">Support Kaushal Ji</h3>
            <p style="font-size:11px;">mandavikaushal913@okaxis</p>
            <img src="https://api.qrserver.com/v1/create-qr-code/?size=140x140&data=upi://pay?pa=mandavikaushal913@okaxis" width="140">
            <button class="f-btn" style="width:100%; margin-top:15px;" onclick="hidePop()">Close</button>
        </div>
    </div>

    <div class="header">
        <div style="text-align:center;">
            <div class="icon-btn" id="login-trigger" onclick="showLogin()">üîê</div>
            <span class="icon-label">Login</span>
        </div>

        <div style="text-align:center;">
            <b style="font-size:13px; color:var(--main);">MI PLAYER PRO</b>
            <select onchange="setView(this.value)" style="background:none; border:none; color:#888; font-size:10px; display:block; margin:auto; outline:none;">
                <option value="mobile">Mobile</option>
                <option value="laptop">Laptop</option>
            </select>
        </div>

        <div style="text-align:center;" onclick="shareApp()">
            <div class="icon-btn">üì§</div>
            <span class="icon-label">Share</span>
        </div>
        
        <div onclick="toggleMenu(event)" style="cursor:pointer; color:var(--main); font-size:20px;">‚ãÆ</div>
    </div>

    <div id="drop-menu">
        <div class="m-item" onclick="showReg()">üÜî Register Account</div>
        <div class="m-item" onclick="window.open('https://wa.me/919129191898')">üí¨ WhatsApp</div>
        <div class="m-item" onclick="window.location.href='tel:9129191898'">üìû Call Support</div>
        <div class="m-item" onclick="showUPI()">üí∞ Support (UPI)</div>
        <div class="m-item" style="color:red;" onclick="location.reload()">üì¥ Logout</div>
    </div>

    <div class="main-container">
        <div class="player-side">
            <div id="user-welcome" style="font-weight:bold; font-size:16px; color:var(--main);">Guest Mode</div>
            <div id="track-title" style="color:#888; font-size:11px; margin-top:5px; height:15px; overflow:hidden;">No Media</div>

            <div class="display-area">
                <div id="music-ui" class="music-anim">üéµ</div>
                <video id="vid-p" controls></video>
                <img id="img-p">
            </div>

            <input type="range" id="seek" class="seek-bar" value="0">
            
            <div class="controls">
                <button onclick="changeTrack(-1)" style="background:none; border:none; color:#fff; font-size:25px;">‚èÆ</button>
                <button id="play-trigger" class="p-btn" onclick="handlePlay()">‚ñ∂</button>
                <button onclick="changeTrack(1)" style="background:none; border:none; color:#fff; font-size:25px;">‚è≠</button>
            </div>

            <div class="btn-group">
                <label class="f-btn">üéµ Audio <input type="file" hidden multiple accept="audio/*" onchange="importFiles(event, 'audio')"></label>
                <label class="f-btn">üé• Video <input type="file" hidden multiple accept="video/*" onchange="importFiles(event, 'video')"></label>
                <label class="f-btn">üñº Image <input type="file" hidden multiple accept="image/*" onchange="importFiles(event, 'image')"></label>
            </div>
            
            <div id="mobile-playlist" style="width:100%; margin-top:20px; text-align:left;">
                <b style="font-size:11px; color:var(--main);">Current Playlist</b>
                <div id="m-list-cont"></div>
            </div>
        </div>

        <div class="playlist-side" id="side-list">
            <b style="color:var(--main); display:block; margin-bottom:10px;">Master Playlist</b>
            <div id="l-list-cont"></div>
        </div>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyDQ0Y8M9OGSInOlUltuysgmKOYGKX8dQvg",
        databaseURL: "https://calculator-by-kaushalji-default-rtdb.firebaseio.com",
        projectId: "calculator-by-kaushalji",
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let playlist = [], cursor = 0, currentUser = null;
    let audio = new Audio();
    let video = document.getElementById('vid-p');
    let active = audio;

    function toBase64(file) {
        return new Promise((r) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => r(reader.result);
        });
    }

    async function handleRegister() {
        const n = document.getElementById('r-name').value;
        const p = document.getElementById('r-phone').value;
        const pw = document.getElementById('r-pass').value;
        const img = document.getElementById('r-img').files[0];
        if(!p || !pw) return alert("Phone & Password required!");
        const b64Img = img ? await toBase64(img) : "";
        const user = { name: n||"User", phone: p, password: pw, profilePic: b64Img };
        await db.ref('users/' + p).set(user);
        alert("Registration Successful!");
        hidePop();
        showLogin();
    }

    async function handleLogin() {
        const p = document.getElementById('l-phone').value;
        const pw = document.getElementById('l-pass').value;
        const snap = await db.ref('users/' + p).once('value');
        if(snap.exists() && snap.val().password === pw) {
            startSession(snap.val());
        } else { alert("Invalid Credentials!"); }
    }

    function startSession(user) {
        currentUser = user;
        document.getElementById('user-welcome').innerText = "Namaste, " + user.name;
        hidePop();
        if(user.profilePic) {
            document.getElementById('login-trigger').innerHTML = `<img src="${user.profilePic}" style="width:100%;height:100%;object-fit:cover;">`;
        }
        syncCloud();
    }

    async function importFiles(e, type) {
        const files = Array.from(e.target.files);
        for(let file of files) {
            const b64 = await toBase64(file);
            const item = { name: file.name, url: b64, type: type };
            if(currentUser) {
                db.ref('playlists/' + currentUser.phone).push(item);
            } else {
                playlist.push(item);
                renderLists();
            }
        }
    }

    function syncCloud() {
        db.ref('playlists/' + currentUser.phone).on('value', snap => {
            playlist = [];
            snap.forEach(child => { 
                let data = child.val();
                data.id = child.key; // Store key for deletion
                playlist.push(data); 
            });
            renderLists();
        });
    }

    function renderLists() {
        const conts = [document.getElementById('m-list-cont'), document.getElementById('l-list-cont')];
        conts.forEach(c => {
            if(!c) return;
            c.innerHTML = "";
            playlist.forEach((item, i) => {
                const d = document.createElement('div');
                d.className = 'list-item';
                d.innerHTML = `
                    <div style="flex:1" onclick="loadTrack(${i})">
                        ${item.type === 'audio' ? 'üéµ' : item.type === 'video' ? 'üé•' : 'üñºÔ∏è'} ${item.name}
                    </div>
                    <div class="del-btn" onclick="deleteTrack('${item.id}', ${i})">üóëÔ∏è</div>
                `;
                c.appendChild(d);
            });
        });
    }

    function deleteTrack(id, index) {
        if(!confirm("H‡§ü‡§æ‡§®‡§æ ‡§ö‡§æ‡§π‡§§‡•á ‡§π‡•à‡§Ç?")) return;
        if(currentUser && id !== "undefined") {
            db.ref('playlists/' + currentUser.phone + '/' + id).remove();
        } else {
            playlist.splice(index, 1);
            renderLists();
        }
    }

    function shareApp() {
        if (navigator.share) {
            navigator.share({
                title: 'MI PLAYER PRO',
                text: 'Check out this amazing player by Kaushal Ji!',
                url: window.location.href
            });
        } else {
            alert("Share Link: " + window.location.href);
        }
    }

    function loadTrack(i) {
        cursor = i;
        const item = playlist[i];
        audio.pause(); video.pause();
        document.getElementById('music-ui').style.display = 'none';
        document.getElementById('vid-p').style.display = 'none';
        document.getElementById('img-p').style.display = 'none';
        document.getElementById('track-title').innerText = item.name;

        if(item.type === 'audio') {
            document.getElementById('music-ui').style.display = 'flex';
            active = audio; audio.src = item.url; audio.play();
        } else if(item.type === 'video') {
            document.getElementById('vid-p').style.display = 'block';
            active = video; video.src = item.url; video.play();
        } else {
            document.getElementById('img-p').style.display = 'block';
            document.getElementById('img-p').src = item.url;
            active = { paused: true, play: ()=>{}, pause: ()=>{} };
        }
        document.getElementById('play-trigger').innerText = '‚è∏';
    }

    function handlePlay() {
        if(active.paused) { active.play(); document.getElementById('play-trigger').innerText = '‚è∏'; }
        else { active.pause(); document.getElementById('play-trigger').innerText = '‚ñ∂'; }
    }

    function changeTrack(dir) {
        cursor += dir;
        if(cursor >= 0 && cursor < playlist.length) loadTrack(cursor);
    }

    function showLogin() { document.getElementById('login-box').style.display = 'flex'; }
    function showReg() { document.getElementById('reg-box').style.display = 'flex'; }
    function showUPI() { document.getElementById('upi-box').style.display = 'flex'; }
    function hidePop() { document.querySelectorAll('.overlay').forEach(o => o.style.display='none'); }
    function toggleMenu(e) { e.stopPropagation(); const m = document.getElementById('drop-menu'); m.style.display = (m.style.display === 'flex') ? 'none' : 'flex'; }
    function setView(v) {
        const f = document.getElementById('frame');
        v === 'laptop' ? f.classList.add('laptop-mode') : f.classList.remove('laptop-mode');
    }

    setInterval(() => {
        const d = new Date();
        document.getElementById('clock').innerText = d.getHours() + ":" + String(d.getMinutes()).padStart(2,'0');
    }, 1000);

    window.onclick = () => document.getElementById('drop-menu').style.display='none';
    
    // Update seek bar for both audio and video
    const updateSeek = () => {
        const s = document.getElementById('seek');
        if(active.duration) { s.max = active.duration; s.value = active.currentTime; }
    };
    audio.ontimeupdate = updateSeek;
    video.ontimeupdate = updateSeek;
    document.getElementById('seek').oninput = (e) => { active.currentTime = e.target.value; };
</script>
    <script>
    // PWA Offline Logic in Single File
    const swCode = `
        const CACHE_NAME = 'mi-player-v1';
        const assets = ['./', window.location.href];

        self.addEventListener('install', (e) => {
            e.waitUntil(
                caches.open(CACHE_NAME).then(cache => cache.addAll(assets))
            );
            self.skipWaiting();
        });

        self.addEventListener('fetch', (e) => {
            e.respondWith(
                caches.match(e.request).then(res => res || fetch(e.request))
            );
        });
    `;

    if ('serviceWorker' in navigator) {
        const blob = new Blob([swCode], { type: 'text/javascript' });
        const swUrl = URL.createObjectURL(blob);
        
        navigator.serviceWorker.register(swUrl).then(() => {
            console.log("MI Player: Offline mode enabled!");
        }).catch(err => console.log("PWA Error", err));
    }
</script>

</body>
</html>
