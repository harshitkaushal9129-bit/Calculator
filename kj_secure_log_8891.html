<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>SECURE ACCESS - KAUSHAL JI</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root { --neon: #00ffcc; --bg: #050505; --red: #ff3333; --gold: #ffcc00; --card: #111; --wa: #25D366; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: #fff; margin: 0; padding: 20px; overflow-x: hidden; }
        
        #lock-screen { position: fixed; inset: 0; background: #000; display: flex; align-items: center; justify-content: center; z-index: 10000; }
        .lock-card { background: var(--card); padding: 40px; border-radius: 20px; border: 1px solid var(--neon); text-align: center; box-shadow: 0 0 30px rgba(0,255,204,0.1); }
        
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #222; padding-bottom: 15px; margin-bottom: 20px; gap: 20px; flex-wrap: wrap; }
        .stats-bar { display: flex; gap: 20px; margin-bottom: 20px; }
        .stat-card { background: var(--card); padding: 15px 25px; border-radius: 12px; border-left: 4px solid var(--neon); flex: 1; min-width: 150px; }
        
        .search-box { flex: 1; max-width: 400px; }
        input { width: 100%; padding: 12px; background: #151515; border: 1px solid #333; color: #fff; border-radius: 8px; outline: none; transition: 0.3s; box-sizing: border-box; }
        input:focus { border-color: var(--neon); box-shadow: 0 0 10px rgba(0,255,204,0.2); }

        .table-container { background: var(--card); border-radius: 12px; overflow: hidden; border: 1px solid #222; }
        table { width: 100%; border-collapse: collapse; }
        th { background: #1a1a1a; color: var(--neon); padding: 15px; text-align: left; font-size: 13px; text-transform: uppercase; }
        td { padding: 12px 15px; border-bottom: 1px solid #222; font-size: 14px; }
        tr:hover { background: #1a1a1a; }
        tr:focus { background: rgba(0,255,204,0.05); outline: none; }

        .pass-text { color: var(--gold); filter: blur(8px); transition: 0.3s; font-family: monospace; user-select: none; }
        tr:focus .pass-text { filter: blur(0); color: var(--neon); }
        
        .user-pic { width: 38px; height: 38px; border-radius: 50%; object-fit: cover; border: 2px solid #333; }
        .btn { padding: 8px 12px; border-radius: 8px; cursor: pointer; font-weight: bold; transition: 0.3s; border: 1px solid transparent; font-size: 12px; }
        .btn-del { color: var(--red); border-color: var(--red); background: transparent; }
        .btn-del:hover { background: var(--red); color: #fff; }
        .btn-wa { color: var(--wa); border-color: var(--wa); background: transparent; margin-right: 5px; }
        .btn-wa:hover { background: var(--wa); color: #fff; }
        .btn-export { background: var(--neon); color: #000; font-size: 14px; }

        .action-cell { white-space: nowrap; }
    </style>
</head>
<body>

<div id="lock-screen">
    <div class="lock-card">
        <h1 style="color:var(--neon); margin:0;">üîê ADMIN AUTH</h1>
        <p style="color:#888; font-size: 14px;">Kaushal Ji, Enter Master Key</p>
        <input type="password" id="m-key" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" onkeypress="if(event.key==='Enter') verify()" style="text-align: center; letter-spacing: 5px;">
        <br><br>
        <button onclick="verify()" class="btn btn-export" style="width: 100%;">UNLOCK SYSTEM</button>
    </div>
</div>

<div id="admin-panel" style="display:none;">
    <div class="header">
        <div>
            <h2 style="margin:0; color:var(--neon);">CONTROL PANEL</h2>
            <small style="color:#666;">Welcome, Kaushal Ji</small>
        </div>
        <div class="search-box">
            <input type="text" id="search" placeholder="üîç Search by Name or Phone..." onkeyup="filterUsers()">
        </div>
        <div style="display:flex; gap:10px;">
            <button class="btn btn-export" onclick="exportData()">üì• EXCEL REPORT</button>
            <button class="btn" style="background:#222; color:#fff;" onclick="location.reload()">LOGOUT</button>
        </div>
    </div>

    <div class="stats-bar">
        <div class="stat-card">
            <div style="color:#888; font-size:12px;">TOTAL USERS</div>
            <div id="count" style="font-size:24px; font-weight:bold; color:var(--neon);">0</div>
        </div>
        <div class="stat-card" style="border-left-color: var(--wa);">
            <div style="color:#888; font-size:12px;">COMMUNICATION</div>
            <div style="font-size:24px; font-weight:bold; color:var(--wa);">READY</div>
        </div>
    </div>

    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>User</th>
                    <th>Name</th>
                    <th>Phone (UID)</th>
                    <th>Security Key</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="user-rows"></tbody>
        </table>
    </div>
</div>

<script>
    const SECRET = "KAUSHAL@9129"; 
    const firebaseConfig = {
        apiKey: "AIzaSyDQ0Y8M9OGSInOlUltuysgmKOYGKX8dQvg",
        databaseURL: "https://calculator-by-kaushalji-default-rtdb.firebaseio.com",
        projectId: "calculator-by-kaushalji",
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();
    let allUsers = [];

    function verify() {
        if(document.getElementById('m-key').value === SECRET) {
            document.getElementById('lock-screen').style.display = 'none';
            document.getElementById('admin-panel').style.display = 'block';
            fetchData();
        } else { alert("Access Denied!"); }
    }

    function fetchData() {
        db.ref('users').on('value', (snap) => {
            allUsers = [];
            snap.forEach(child => {
                let u = child.val();
                u.phone = child.key;
                allUsers.push(u);
            });
            renderTable(allUsers);
        });
    }

    function renderTable(data) {
        const container = document.getElementById('user-rows');
        document.getElementById('count').innerText = data.length;
        container.innerHTML = "";
        data.forEach(user => {
            const tr = document.createElement('tr');
            tr.tabIndex = 0;
            tr.innerHTML = `
                <td><img src="${user.profilePic || 'https://via.placeholder.com/35'}" class="user-pic"></td>
                <td><b style="color:#eee">${user.name}</b></td>
                <td style="color:#888">${user.phone}</td>
                <td><span class="pass-text">${user.password}</span></td>
                <td class="action-cell">
                    <button class="btn btn-wa" onclick="contactUser('${user.phone}', '${user.name}')">üí¨ MSG</button>
                    <button class="btn btn-del" onclick="deleteUser('${user.phone}')">üóëÔ∏è DEL</button>
                </td>
            `;
            container.appendChild(tr);
        });
    }

    function filterUsers() {
        const term = document.getElementById('search').value.toLowerCase();
        renderTable(allUsers.filter(u => u.name.toLowerCase().includes(term) || u.phone.includes(term)));
    }

    function contactUser(phone, name) {
        const msg = encodeURIComponent(`Namaste ${name}, Kaushal Ji ki taraf se MI PLAYER PRO mein aapka swagat hai!`);
        window.open(`https://wa.me/91${phone}?text=${msg}`, '_blank');
    }

    async function deleteUser(id) {
        if(confirm(`‚ö†Ô∏è DELETE USER ${id}? This cannot be undone.`)) {
            await db.ref('users/' + id).remove();
            await db.ref('playlists/' + id).remove();
        }
    }

    function exportData() {
        let csv = "Name,Phone,Password\n";
        allUsers.forEach(u => csv += `${u.name},${u.phone},${u.password}\n`);
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.setAttribute('href', url);
        a.setAttribute('download', `KaushalJi_DB_Report.csv`);
        a.click();
    }

    document.addEventListener('contextmenu', e => e.preventDefault());
    setInterval(() => { debugger; }, 100);
</script>
</body>
</html>
