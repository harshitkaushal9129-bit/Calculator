<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <title>SECURE ACCESS - KAUSHAL JI</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
        :root { --neon: #00ffcc; --bg: #050505; --red: #ff3333; --wa: #25D366; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: #fff; margin: 0; padding: 20px; }
        
        /* Password Blur Logic */
        .pass-text { color: #ffcc00; filter: blur(10px); transition: 0.3s; user-select: none; }
        tr:focus .pass-text { filter: blur(0); color: var(--neon); }
        tr { outline: none; cursor: pointer; }

        #lock-screen { position: fixed; inset: 0; background: #000; display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 10000; }
        .lock-card { background: #111; padding: 40px; border-radius: 20px; border: 1px solid var(--neon); text-align: center; }
        
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #222; padding-bottom: 15px; margin-bottom: 20px; }
        input { padding: 12px; background: #151515; border: 1px solid #333; color: #fff; border-radius: 8px; outline: none; }
        
        table { width: 100%; border-collapse: collapse; background: #111; border-radius: 12px; overflow: hidden; }
        th { background: #1a1a1a; color: var(--neon); padding: 15px; text-align: left; text-transform: uppercase; font-size: 13px; }
        td { padding: 12px 15px; border-bottom: 1px solid #222; font-size: 14px; }
        tr:hover { background: #161616; }

        .user-pic { width: 35px; height: 35px; border-radius: 50%; object-fit: cover; }
        .btn { border: none; padding: 7px 12px; border-radius: 6px; cursor: pointer; font-weight: bold; transition: 0.3s; }
        .btn-del { background: rgba(255, 51, 51, 0.2); color: var(--red); border: 1px solid var(--red); }
        .btn-wa { background: rgba(37, 211, 102, 0.2); color: var(--wa); border: 1px solid var(--wa); margin-right: 5px; }
        .btn-wa:hover { background: var(--wa); color: #fff; }
        
        .badge { background: var(--neon); color: #000; padding: 2px 8px; border-radius: 10px; font-weight: bold; }
        .new-label { background: var(--wa); color: #000; font-size: 10px; padding: 2px 5px; border-radius: 4px; margin-left: 5px; animation: blink 1s infinite; }
        @keyframes blink { 50% { opacity: 0.5; } }
    </style>
</head>
<body>

<div id="lock-screen">
    <div class="lock-card">
        <h1 style="color:var(--neon);">üîê KAUSHAL JI CONTROL</h1>
        <input type="password" id="m-key" placeholder="Enter Master Key..." onkeypress="if(event.key==='Enter') verify()">
        <button onclick="verify()" style="background:var(--neon); margin-top:20px; padding:10px 30px; border-radius:8px; cursor:pointer; font-weight:bold;">UNLOCK</button>
    </div>
</div>

<div id="admin-panel" style="display:none;">
    <div class="header">
        <h2>DATABASE <span id="count" class="badge">0</span></h2>
        <input type="text" id="search" placeholder="üîç Search User..." onkeyup="filterUsers()" style="width:300px;">
        <button onclick="location.reload()" style="background:#333; color:white; border:none; padding:10px 20px; border-radius:8px; cursor:pointer;">LOGOUT</button>
    </div>

    <table>
        <thead>
            <tr>
                <th>Profile</th>
                <th>Name</th>
                <th>Phone (UID)</th>
                <th>Password</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody id="user-rows"></tbody>
    </table>
</div>

<script>
    const SECRET = "KAUSHAL@9129"; 
    const firebaseConfig = {
        apiKey: "AIzaSyDQ0Y8M9OGSInOlUltuysgmKOYGKX8dQvg",
        databaseURL: "https://calculator-by-kaushalji-default-rtdb.firebaseio.com",
        projectId: "calculator-by-kaushalji",
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    function verify() {
        if(document.getElementById('m-key').value === SECRET) {
            document.getElementById('lock-screen').style.display = 'none';
            document.getElementById('admin-panel').style.display = 'block';
            startListening();
        } else { alert("Unauthorized!"); }
    }

    let allUsers = [];
    let isInitialLoad = true;

    function startListening() {
        // 'child_added' event naye user ko detect karega
        db.ref('users').on('child_added', (snap) => {
            let user = snap.val();
            user.phone = snap.key;
            
            // Agar initial load khatam ho chuka hai, matlab ye naya user hai
            if (!isInitialLoad) {
                notifyNewUser(user);
            }
            
            allUsers.push(user);
            renderTable(allUsers);
        });

        // Pehle se maujood data load hone ke baad flag change karein
        db.ref('users').once('value', () => {
            isInitialLoad = false;
        });

        // Sync for deletions
        db.ref('users').on('child_removed', (snap) => {
            allUsers = allUsers.filter(u => u.phone !== snap.key);
            renderTable(allUsers);
        });
    }

    function notifyNewUser(user) {
        // Browser Notification (Optional)
        if (Notification.permission === "granted") {
            new Notification("New User Alert!", { body: `${user.name} joined MI Player Pro` });
        }
        
        // Auto-Open WhatsApp (User interaction rules apply)
        alert(`Naya User Aaya Hai: ${user.name}\nWhatsApp bhejane ke liye taiyaar rahein.`);
        sendWhatsApp(user.phone, user.name);
    }

    function sendWhatsApp(phone, name) {
        const msg = encodeURIComponent(`Namaste ${name} Ji, MI PLAYER PRO mein register karne ke liye shukriya! üôè - Kaushal Ji`);
        window.open(`https://wa.me/91${phone}?text=${msg}`, '_blank');
    }

    function renderTable(data) {
        const container = document.getElementById('user-rows');
        document.getElementById('count').innerText = data.length;
        container.innerHTML = "";
        
        // Ulta dikhayenge taaki naya user upar dikhe
        [...data].reverse().forEach(user => {
            const tr = document.createElement('tr');
            tr.tabIndex = 0;
            tr.innerHTML = `
                <td><img src="${user.profilePic || 'https://via.placeholder.com/35'}" class="user-pic"></td>
                <td><b>${user.name}</b> ${isNew(user) ? '<span class="new-label">NEW</span>' : ''}</td>
                <td>${user.phone}</td>
                <td><span class="pass-text">${user.password}</span></td>
                <td>
                    <button class="btn btn-wa" onclick="sendWhatsApp('${user.phone}', '${user.name}')">üí¨ MSG</button>
                    <button class="btn btn-del" onclick="deleteUser('${user.phone}')">üóëÔ∏è</button>
                </td>
            `;
            container.appendChild(tr);
        });
    }

    function isNew(user) {
        // Logic for highlighting new users (optional)
        return false; 
    }

    function filterUsers() {
        const term = document.getElementById('search').value.toLowerCase();
        renderTable(allUsers.filter(u => u.name.toLowerCase().includes(term) || u.phone.includes(term)));
    }

    async function deleteUser(id) {
        if(confirm(`User ${id} delete karein?`)) {
            await db.ref('users/' + id).remove();
            await db.ref('playlists/' + id).remove();
        }
    }

    // Protection Script
    document.addEventListener('contextmenu', e => e.preventDefault());
    setInterval(() => { debugger; }, 1000);
</script>
</body>
</html>
